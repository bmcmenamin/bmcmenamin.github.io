---
layout: post
title: "Moby Dick 2: The Cetaceans Strike Back"
author: "Brenton McMenamin"
tags: [math&data, model-wrangler]
---

I've heard that Moby Dick is a pretty good book. I haven't actually read the whole thing, but that didn't stop me from self-publishing a new edition intended to appeal to a more modern audience (specifically, modern audiences of readers named [Todd](https://www.amazon.com/Moby-Dick-Todd-Herman-Melville/dp/1539665054)). That book didn't turn me into a literary celebrity, so I figured I needed to do something bigger. I needed to write the sequel.

Well, not *me* me. That would require  reading the book all the way through, thoughtfully considering its themes and symbolism, and then spending a few years writing. Instead, I decided to build a robot that would do it all for me. Andrej Karpathy put together a great [blog-post/repo/demo](http://karpathy.github.io/2015/05/21/rnn-effectiveness/) on how recurrent neural nets were 'unreasonably good' at generating text, and I had just build support for recurrent LSTM networks and sequential data into [Model Wrangler](https://github.com/bmcmenamin/model_wrangler). This would be a great end-to-end test for my package.


### Source material

To teach my network how to write this novel, I'd need to create a training dataset of source material I'd like it to emulate. Using Project Gutenberg, I built a concise 'reading list' with ~1.5 MB of text data:

* Naturally, I included the original [Moby-Dick; or, The Whale (1858)](https://www.gutenberg.org/files/2701/2701-0.txt)

* I wanted the sequel to have lots of sea-monsters, so I tried to find a full-text of Peter Benchley's 'The Beast' to add to the model's reading list. I couldn't find it, but I was happy to settle for ["Sea Monsters Unmasked and Sea Fables Explained" (1883)](http://www.gutenberg.org/cache/epub/36677/pg36677.txt)

* Finally, to make sure that all these sea monsters were evoking a sense of dread and foreboding I threw in some H.P. Lovecraft: [The Shunned House (1924)](http://www.gutenberg.org/cache/epub/31469/pg31469.txt), [The Dunwich Horror (1929)](http://www.gutenberg.org/cache/epub/50133/pg50133.txt)


### The next great American model

Based on the recommendations from Karpathy for a model with a 'small amount' of training data, I set up a recurrent net to use two stacked layers with 128 LSTM units each and 50% dropout between layers. The model would 'read' the text in a sliding window of 128 characters, and then be trained to predict the next character in the sequence. Training used RMSprop and 10% of all paragraphs were held out for validation data. Training ran on a Google Cloud GPU for as long as I was willing to pay.

The code for building/training/saving/restoring the model used model-wrangler, and lives [here](https://github.com/bmcmenamin/sundries/blob/master/moby_sequel/build_train_model.py).


### The next great American novel

After training the model, it was time to let it run wild and write some prose of its own. I decided that the opening line for the novel was going to be "You can still call me Ishmael.", but everything after that was machine-generated. You can see a sample below:

```
You can still call me Ishmael. juck a sun reagound starnce? with boll ford? and undeling that uncontious him??hite a plane of the night down???wa? thoug? when wish sumbor? ore?? Narous my ha?muspeare? aboutht of fimserts? tells rouz hea? one of the 2c1yt of see dewe contideatout sail? then??? ?Marrong is sovered? and who looked uncestive all the PI juckCon then diging which I have on eaghtus these bidrait down to ke with the screath? there this traye? we to twe elagranisly for Yemora head? with board to the narpha? afonith ocable townel same counts? re?for now over one of sing is of its very heard? and shapp in the great long been any leneta? than is a clackes it claiter? so cynsid with water on must recomstlle? in the shirm? and a rown the shore? yo yed a moot sem of finces? and many of ext cares long there he head and 4ctell rise? which arg the taige from the considered with roaring it? is every or one of whoph these brincless? but it was prowardly to inform the slaginat you?? one ?whele is son? twance? I fleved upon claated a chally cactureation to cuttlicatis shrend that sailly lack sippleture something all but cemaratel beford? the wores in like baskinn? its general cusserves?land that it all bedie to the rage oft in stoke on bull from thrie for the ever cansed by coasts? and seconting rim? and him is the gentad whith fure arobed? Dasinaster? in naturgaition of Rigra? panch??a cuterua ame? then for a mutach? in mann? Muph Dampeciet? and numerable fase? coustrane my son to eeliNaty you compunation containing the marnceled to keep peefer of a larged reckston? on a glayky of the water? innumerailes bear?but to finge? and I wnen almost in sight of one of what it with? he?sh anders? there long belling that beasted whith engle was? the passain had these jecervently experime? pas arr of the huse be allowe from twis three wollmose liget and from hemmint for it? a coloss? men? anl insudaly? the lefgry for it? ehand indeesestling the bread hist? with a hear body bastain? to ng whith at aim? and for firel behinerole langies? and there fentwed to the praim of the histlengs to the nerentation cass calse?stheng??ex?I fumen that thoss all I worning ?goinnentshor? bech seesed by the two pountion of feamous the last whale flen with seaps it put heard of his gread uneermation? stirn like the master in werg the same counted air of sight?st furrors??wheshers heil of citaus? there ob it ap?saigineable? such a brawing the mosentions of the shis with silend a suck anwarbs? and coilor cromet??inkmost was dare coldssed a foreraccess shinging sonerowas and recolled them thite mases and carsled thaids these thilf?s Noungene of the poine of them? doun?a looking Pip? that upon the get??the largs I all but to bathes in the Amery dow? to ubel mich atco the circlm aromadiven oc this sail? a comarss if hess oftingule? I forgiter of that olaboutr in plodued a moush so twengen whopr of the hight? of the same piling contined as are awness Frra? on eclula? shere about gid upon the grown or for the hare of edcents of Lif? ?make? have I was excurte that ap tuiet padinct of him? ex? or oneerf and known cutles almost somj him and lail him as the white expacted in the ?deach? god not partion of the bird fulled with on ear? lattinatiBation on octous which SI gold of him? excaled my noth that a commanabla is fir limber? and to fore aractly yor complayinaled bodno his fwet in it? Ser intrettr? inly parnect of the fwas Carts and lay for it? in your in a mohal whote flemed thaily the ?wayk?? her not beane of the ears? and screwing whale? now und was not only that? mighed a braye on eagh of that undirs shore?twing the ?mearala?dy yaving ever geeved and cented in his cleted of a clay?mination of the divines if whal men? to leeed whales from the ship heard?? For am intelpor? and six there reconta to feave the left hany? that a gohes lock to dreveter of his onzerion? be ablow stars? and thought turn in his tonies of little with sup? an whalemboined a Whale come and battrrale distied? tell and was plesed now activitle of the Ausilar whore then supperres in the fien a chally feath unid? two the oblen am alf what men be sill gilfrow? yet? were cabbor axains from him that? thus for to yel Dhan uncention? seance?to the collfelied jece?la ted this shail that recojearally carraited a trown retose? Arabuch?s foreltionly reperies? It is about the worling be over the gamiled? whiter to seeped Cy the sharkBess? Dasplesing befored bass? in that breathe in tem??inland? we Seco onew and three of is not only trood of the Ragin cowf it sail? over awe died and lontco streption of an anaundraloming or for of its fore him thrighp im the achestlw undsical prodes? re or an owa town the concerially hingess? in a fert? mark the oldes fown a rot ous prodes? from the 1Aese? woremowh to collatest of its? Pe?lical man on? and thood? whiched had beadats all the in geof which these is the mistle which foee liek? and he was centuLitatel inform the sholls? share alowald mound the prefic looks dir? oristlacy in ac
```

This is... not the masterpiece I was hoping for. It has a lot of real little words and pronouncable-ish longer words. But it also has waaay too many question marks and made up words. Here are a couple of theories for why this didn't work:

* Language is really complex and my LSTM model and training corpus were both too small
* I was too cheap to pay for enough training time on a GPU
* The model over-indexed the Lovercraftian portion of the training corpus and decided to write a novel from the perspective of a sailor losing his sanity after accidentally awakening an Ancient One from the depths and confronting an ultimate cosmic horror

I'm going to think about this some more and try to build something better. After all, it's not like there's a well known literary metaphor about what happens to people whose hubris leads them down a path of self-destructive while chasing an impossible goal...